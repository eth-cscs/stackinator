# Stackinator

A tool for building a scientific software stack from a recipe on HPE Cray EX systems.

It is used to build software vClusters on Alps infrastructure at CSCS.

## Getting Stackinator

To get the latest version, download directly from GitHub.

``` bash
git clone https://github.com/eth-cscs/stackinator.git
```

Once installed, add the `bin` sub-directory to your path:

```bash
export PATH="<stackinator-install-path>/bin:$PATH"
```

!!! info
    The `main` branch of Stackinator includes features for Spack v1.0, and may break older recipes.

    For existing recipes use Spack v0.23 and earlier, use [version 5](#versions)

### Requirements

To run stackinator [uv](https://docs.astral.sh/uv/getting-started/installation/) needs to be [installed](https://docs.cscs.ch/guides/terminal/#managing-x86-and-arm).

### Versions

The two supported versions of Stackinator are:

* **v6**: the latest release, which supports Spack 1.0.
    * Introduces breaking changes to the recipe format from v5.
    * [Check out the guide][ref-porting] for porting recipes to the new format.
* **v5**: supports Spack v0.23 (also v0.21 and v0.22) and earlier.
    * Maintained in the git branch `releases/v5`.


## Quick Start

Stackinator generates the make files and spack configurations that build the spack environments that are packaged together in the spack stack.
It can be thought of as equivalent to calling `cmake` or `configure`, before running make to run the configured build.

```bash
# configure the build
stack-config --build $BUILD_PATH --recipe $RECIPE_PATH --system $SYSTEM_CONFIG_PATH
```

Where the `BUILD_PATH` is the path where the build will be configured, the `RECIPE_PATH` contains the [recipe](recipes.md) for the sotware stack, and `SYSTEM_CONFIG_PATH` is the [system configuration](cluster-config.md) for the cluster being targeted.

Once configured, the build stack is built in the build path using make:

```bash
# build the spack stack
cd $BUILD_PATH
env --ignore-environment PATH=/usr/bin:/bin:`pwd -P`/spack/bin make modules store.squashfs -j64
```

See the documentation on [building Spack stacks](building.md) for more information.

Once the build has finished successfully the software can be [installed](installing.md).

!!! alps
    On Alps the software stack can be tested using the [uenv](https://docs.cscs.ch/software/uenv/) image generated by the build:
    ```bash
    uenv start ./store.squashfs
    ```
